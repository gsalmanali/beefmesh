<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://example.com/overlay/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Overlay Network - BeefMesh 1.0</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Overlay Network";
        var mkdocs_page_input_path = "overlay.md";
        var mkdocs_page_url = "/overlay/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> BeefMesh 1.0
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../layout/">Layout</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sessions/">Sessions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../emissions/">Emissions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../utsa/">UTSA Server</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../databases/">Databases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ipfs/">IPFS Network</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../iots/">IoT Network</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Overlay Network</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../shareddrive/">Network Shared Drive</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../blockchain/">Blockchain Network</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../utilities/">Utilities and Monitoring</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples and Applications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging Issues</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">BeefMesh 1.0</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Overlay Network</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="overlay-network">Overlay Network</h1>
<p>Overlay network allows nodes in the network to communicate with each other regardless of their physical location or the underlying network infrastructure. Overlay networks are commonly used in peer-to-peer (P2P) systems, content delivery networks (CDNs), and virtual private networks (VPNs). It can be establisehd using docker and swarm services. We use overlay network in our application for following reasons. </p>
<ol>
<li>It allows calling containerzied applciations by their hostname or container name. There is therefore no need to individually host tons of containers for a domain name.</li>
<li>It provides a secure layer for containers to interact and isolates it from other public networks. It further makes it easier to discover services over the dedicated network.</li>
<li>It is secure, resiliant and enables efficient communication between P2P and CDN architectures. </li>
</ol>
<p>Setting up an overlay network requires more than one physical hosts that can be reached over internet. If you are using virtual machines for testing on the same physical host, make sure they are using 'Bridged Adapter' so that each VM gets a separate network adddress. NAT will not work for creating overlay on VMs on the same host machine because this assigns them the same network address. Further, WSL machines on windows also get the same network addresses and currently (January 2024) don't support bridged networking. The scripts provided here have been tested with VirtualBox VMs by setting network to use 'Bridged Adapter'.  </p>
<p>To get started, grab the network addresses of each machine and ping other machines to check if they are reachable. Run from within overlaynetwork folder. </p>
<pre><code> # Run from within 'overlay' folder
 ./overlay-network.sh ipaddress

 # Replace with other hosts ip address    
  ping &lt;other_host_ip_address&gt;
</code></pre>
<p>The overlay-network.sh script saves environment variables in /overlaynetwork/env folder everytime its called. One of the host machines needs to start a docker swarm manager and others can join as 'manager' or 'workers' depending upon the requirements and hierarchy of network. On any one of the host machines, first remove any existing swarm network and create a new one. </p>
<pre><code> # (Optional) Remove existing overlay network 
 ./overlay-network.sh remove

 # Create a new swarm overlay network 
 ./overlay-network.sh create
</code></pre>
<p>Successful creation of swarm overlay network stores 'manager' and 'worker' keys in /overlaynetwork/env folder (swarmmanager.txt and swarmworker.txt). These keys are needed in other host machine and should be shared and avialble in overlaynetwork/env folder before they can join the overlay network. Once the files are successfully shared and in place, run the provided script to join as 'manager' or 'worker'.</p>
<pre><code> # Join as manager 
 ./overlay-network.sh joinasmanager

 # Join as worker
 ./overlay-network.sh joinasworker
</code></pre>
<p>Ocassionally, an error shown below may pop up:    </p>
<p><code>Error response from daemon: manager stopped: can't initialize raft node: rpc error: code = Unknown desc = could not connect to prospective new cluster member using its advertised address: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing dial tcp x.x.x.x:2377: connect: no route to host"</code></p>
<p>Overlay network works on specific ports which need to be configured to allow traffic coming and and out of the host network interface. To allow configuring the specific ports, either use ufw (Ubuntu) application or firewall-cmd (Debian, CentOS or others) application. To set network filters using ufw (note: may require raised priviliges!)</p>
<pre><code>   # Apply ufw filters
./overlay-network.sh applyufw
# Remove ufw filters
./overlay-network.sh removeufw
# list applied ufw filters 
./overlay-network.sh listufw
# disable ufw application 
./overlay-network.sh disableufw
# enable ufw application 
./overlay-network.sh enableufw
</code></pre>
<p>To set network filters using firewall-cmd (note: may require raised priviliges!)</p>
<pre><code># Apply firewall filters
./overlay-network.sh applyfirewall
# Remove firewall filters
./overlay-network.sh removefirewall
# list applied firewall filters 
./overlay-network.sh listfirewall
# disable firewall application 
./overlay-network.sh disablefirewall
# enable firewall application 
./overlay-network.sh enablefirewall
</code></pre>
<p><code>Note: Using both filters on a linux system will cause the same error mentioned earlier due to conflicts. For a similar error scenario, remove and disable either of the network filter application completely and apply and enable the other one!</code></p>
<p>Once other hosts have joined the overlay network, create a named network that will used to connect containerized applications. (Note that this can be done on 'managers' only and since we join hosts as managers, we can create it from any host connected to the overlay network).</p>
<pre><code>   # Create a named network to use on overlay 
./overlay-network.sh createoverlay &lt;network_name&gt;
# Remove a named network from overlay
  ./overlay-network.sh removeoverlay &lt;network_name&gt;
</code></pre>
<p>At any time, list the networks (bridge, overlay, host, null) available to use with contaiers</p>
<pre><code>./overlay-network.sh listnetworks
</code></pre>
<p>To directly source variables stored in overlaynetwork/env folder to use in bash terminal </p>
<pre><code>   # ipaddress=x.x.x.x
   source overlaynetwork/env/hostip.sh
   # swarm_manager_key
   manager_key=$(cat overlaynetwork/env/swarmmanager.txt)
   # swam_worker_key
   worker_key=$(cat overlaynetwork/env/swarmworker.txt)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../iots/" class="btn btn-neutral float-left" title="IoT Network"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../shareddrive/" class="btn btn-neutral float-right" title="Network Shared Drive">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../iots/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../shareddrive/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
